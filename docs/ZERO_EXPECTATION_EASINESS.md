# Zero-Expectation QUBO가 SA에게 Trivially 쉬운 이유

## 1. 문제 제기

Zero-Expectation QUBO는 `E[q_ij] = 0`을 달성하여 Q 행렬 계수가 랜덤 QUBO와 통계적으로 유사하도록 설계되었다. 그러나 SA(Simulated Annealing)로 풀면 **num_reads=1 (단 1회 샘플링)에서도 N=500까지 100% 성공**한다.

이 문서는 에너지 랜드스케이프 관점에서 그 원인을 분석한다.

---

## 2. 벤치마크 결과: num_reads=1 3-Way 비교

동일한 SA 조건 (num_reads=1, num_sweeps=1000)에서 3가지 QUBO 생성 방식을 비교.

### Zero-Expectation

| N | 성공률 | 에너지비 | 해밍거리 | 시간 |
|---|--------|---------|---------|------|
| 10 | **100%** | 1.0000 | 0 | 0.00s |
| 20 | **100%** | 1.0000 | 0 | 0.00s |
| 50 | **100%** | 1.0000 | 0 | 0.00s |
| 100 | **100%** | 1.0000 | 0 | 0.01s |
| 200 | **100%** | 1.0000 | 0 | 0.03s |
| 300 | **100%** | 1.0000 | 0 | 0.09s |
| 500 | **100%** | 1.0000 | 0 | 0.23s |

### Wishart (alpha=0.7)

| N | 성공률 | 에너지비 | 해밍거리 | 해밍/N |
|---|--------|---------|---------|--------|
| 50 | **0%** | 0.8696 | 25.0 | 50% |
| 100 | **0%** | 0.8840 | 46.2 | 46% |
| 200 | **0%** | 0.9023 | 93.5 | 47% |
| 500 | **0%** | 0.8980 | 254.8 | 51% |

### Quiet Planting (alpha=4.2)

| N | 성공률 | 에너지비 | 해밍거리 | 해밍/N |
|---|--------|---------|---------|--------|
| 10 | **20%** | 0.9556 | 3.3 | 33% |
| 20 | **0%** | 0.9411 | 7.1 | 36% |
| 50 | **0%** | 0.9652 | 18.7 | 37% |
| 100 | **0%** | 0.9816 | 28.5 | 29% |

**벤치마크 난이도 순서: Wishart >> Quiet Planting >> Zero-Expectation**

---

## 3. 원인 분석

### 3.1 로컬 미니마가 1개뿐 (= 타겟 자체)

N=16에서 전수 탐색(2^16 = 65,536개 상태)한 결과:

| 방식 | 로컬 미니마 수 | 비율 |
|------|--------------|------|
| **Zero-Expectation** | **1개** | 0.0015% |
| Wishart (alpha=0.7) | **224개** | 0.3418% |
| Wishart (alpha=1.0) | **122개** | 0.1862% |

Zero-Expectation은 에너지 랜드스케이프 전체에 **함정(trap)이 하나도 없다**. SA가 아무 상태에서 출발해도 1-bit flip으로 에너지가 낮아지는 방향이 항상 존재하고, 그 방향을 따라가면 반드시 타겟에 도달한다.

Wishart는 로컬 미니마가 수백 개 존재하며, SA가 metastable 상태에 빠지면 탈출할 수 없다.

### 3.2 Frustration이 0

N=20에서 각 pair (i,j)의 off-diagonal 커플링이 타겟 상태와 일관되는지 분석:

| 방식 | Frustrated pairs |
|------|-----------------|
| **Zero-Expectation** | **0 / 190** (0%) |
| Wishart (alpha=0.7) | **25 / 190** (~13%) |

**Frustration = 서로 다른 pair가 모순되는 상태를 원하는 것.**

Zero-Expectation의 페널티 구조를 보면:

```python
# 타겟이 (0,0)인 pair에 대해
# 오답 (0,1)에 r1 페널티, (1,0)에 r2 페널티, (1,1)에 r3 페널티
# → 3개 모두 양수 → 3개 모두 타겟 (0,0) 방향을 가리킴
```

**모든 pair가 독립적으로 동일한 타겟 방향을 가리킨다.** 변수 간 충돌이 전혀 없으므로 로컬 미니마가 생길 수 없다.

Wishart는 $J_{ij} = -(1/N) \sum_\mu W_{i\mu} W_{j\mu}$로 구성되어, 공유 벡터 W를 통해 커플링이 상관되고, 일부 pair가 서로 모순되는 방향을 선호한다.

### 3.3 에너지가 해밍거리에 선형 비례 (Funnel 구조)

N=16, 전수 탐색 기반 해밍거리별 에너지 프로파일:

#### Zero-Expectation

| 해밍거리 d | 평균 에너지 | 표준편차 | 에너지 범위 |
|-----------|-----------|---------|-----------|
| 0 (타겟) | -109.41 | 0.00 | [-109.41] |
| 1 | -72.38 | 8.90 | [-82.61, -47.82] |
| 2 | -37.34 | 10.11 | [-52.30, 0.00] |
| 3 | -4.29 | 9.60 | [-23.46, 24.69] |
| 4 | +26.79 | 8.27 | [6.37, 49.18] |
| 5 | +55.88 | 6.78 | [35.86, 73.33] |

**에너지 증가 기울기: ~37/bit flip, 셸 내 표준편차: ~9**

→ **신호(37) >> 노이즈(9)**: SA가 어디서든 "타겟 방향이 어딘지" 명확히 감지.

#### Wishart (alpha=0.7)

| 해밍거리 d | 평균 에너지 | 표준편차 | 에너지 범위 |
|-----------|-----------|---------|-----------|
| 0 (타겟) | -2.43 | 0.00 | [-2.43] |
| 1 | -1.16 | 0.49 | [-1.83, -0.37] |
| 2 | -0.06 | 1.04 | [-1.73, 3.20] |
| 3 | +0.87 | 1.50 | [-2.06, 7.65] |
| 4 | +1.63 | 1.87 | [-1.76, 10.95] |
| 5 | +2.23 | 2.16 | [-1.73, 13.97] |

**에너지 증가 기울기: ~1.3/bit flip, 셸 내 표준편차: ~1.5**

→ **신호(1.3) < 노이즈(1.5)**: SA가 방향을 잡을 수 없음. d=3에서 이미 에너지가 d=0보다 낮은 상태가 존재.

### 3.4 에너지 갭이 거대함

N=20에서 전수 탐색 결과:

| 방식 | Ground (E0) | 1st Excited (E1) | 절대 갭 | 상대 갭 |
|------|------------|-----------------|---------|---------|
| **Zero-Expectation** | -329.22 | -290.30 | **38.92** | **11.8%** |
| Wishart (alpha=0.7) | -4.71 | -4.71 | **~0** | **~0%** |

Zero-Expectation은 ground state와 1st excited state 사이에 11.8%의 거대한 에너지 갭이 있어, SA의 열 요동으로도 ground state에서 빠져나갈 수 없다.

Wishart는 near-degenerate 상태가 밀집해 있어 갭이 사실상 0이다. (Z2 대칭으로 인한 bit-flip 대칭 해 포함)

### 3.5 Single-bit flip 에너지 변화

N=20에서 타겟으로부터 1비트만 뒤집었을 때의 에너지 변화:

| 방식 | 최소 Delta E | 최대 Delta E | 평균 Delta E | 음수 delta |
|------|-------------|-------------|-------------|-----------|
| **Zero-Expectation** | **+39.67** | +93.25 | +54.21 | **0/20** |
| Wishart (alpha=0.7) | +0.61 | +2.37 | +1.21 | **0/20** |

둘 다 모든 1-flip이 에너지 증가이지만, ZeroExp의 최소 delta(39.67)는 Wishart의 최대 delta(2.37)보다 **17배** 크다. SA의 thermal noise로 이 장벽을 넘을 확률이 극도로 낮다.

---

## 4. 구조적 원인 요약

### 4.1 페널티 구조의 본질적 차이

```
Zero-Expectation:
  pair(i,j)마다 → 3개의 독립적 양수 페널티 → 타겟 방향으로 일관된 힘

  ∀ pair: "타겟이 최적이다" (일치)
  → frustration = 0 → local minima = 1 → SA trivially solves

Wishart:
  J_ij = -(1/N) Σ_μ W_iμ W_jμ  (공유 벡터 W를 통한 상관)

  일부 pair: "타겟이 최적이다" vs 다른 pair: "다른 상태가 최적이다" (충돌)
  → frustration > 0 → local minima = O(수백) → SA trapped
```

### 4.2 에너지 랜드스케이프 시각화

```
Zero-Expectation (깔때기):           Wishart (울퉁불퉁):

에너지                                에너지
  │                                    │
  │\                                   │\   /\   /\
  │ \                                  │ \_/  \_/  \
  │  \                                 │  ↑    ↑    \___  ← ground state
  │   \                                │ trap  trap
  │    \___  ← ground state            │
  └──────── 상태 공간                   └──────── 상태 공간

모든 경로가 바닥으로 향함             여러 함정이 존재, SA가 빠지면 탈출 불가
```

### 4.3 "통계적 위장"과 "SA 난이도"는 독립

| | Q 행렬 통계 위장 | SA 난이도 |
|---|---|---|
| Zero-Expectation | E[q_ij]=0 달성 (비대각 위장 성공) | **Trivially 쉬움** |
| Wishart | 랜덤 행렬 이론 기반 구조 | **구조적으로 어려움** |

Q 행렬의 **1차 통계량**(평균, 분산)을 위장하는 것은 에너지 **함수** 구조(=상관 구조, frustration, local minima)를 위장하는 것과 전혀 다르다. 계수 분포가 아무리 랜덤해 보여도, 그 계수들이 모두 같은 방향을 가리키면 SA는 즉시 풀어버린다.

---

## 5. 벤치마크로서의 한계와 대안

### 5.1 Zero-Expectation의 한계

- SA가 num_reads=1로도 N=500을 즉시 풀어버림
- 솔버 간 성능 변별력이 전혀 없음
- "어려운 QUBO 벤치마크"라는 목적에 부적합

### 5.2 대안 비교

| 방식 | 난이도 | Ground state 보장 | 통계적 위장 | 난이도 제어 |
|------|--------|-----------------|-----------|-----------|
| Zero-Expectation | 쉬움 | 보장 | 부분적 (비대각만) | 없음 |
| Hard Mode | 쉬움 | 조건부 | 없음 | noise_ratio |
| **Wishart** | **어려움** | **수학적 보장** | 구조적 | **alpha** |
| **Quiet Planting** | **중간** | **보장** | 이론적 (alpha<3.86) | **alpha, field** |

### 5.3 권장 사용 시나리오

- **솔버 정확성 검증**: Zero-Expectation (반드시 풀려야 하는 기본 검증)
- **솔버 성능 벤치마크**: Wishart (alpha=0.7, 실제 난이도 측정)
- **SAT 기반 벤치마크**: Quiet Planting (alpha=4.2, 다른 계산 구조)

---

## 6. 실험 재현

```bash
# Zero-Expectation num_reads=1 scaling (test_zero_expectation.py에서 num_reads=1로 변경 후)
python3 test_zero_expectation.py

# Wishart num_reads=1 scaling
python3 test_wishart.py --scaling 0.7

# Quiet Planting num_reads=1 scaling
python3 test_quiet_planted.py --scaling 4.2
```

**실험 환경**: macOS Darwin 24.6.0, Python 3, neal SimulatedAnnealingSampler, num_sweeps=1000

---

## 7. 관련 문서

- [`Q_MATRIX_ANALYSIS.md`](Q_MATRIX_ANALYSIS.md) — Q 행렬 통계적 구별 가능성 분석 (대각 편향, 비대각 편향)
- [`WISHART_EXPERIMENT.md`](WISHART_EXPERIMENT.md) — Wishart 앙상블 실험 보고서
- [`QUIET_PLANTING_EXPERIMENT.md`](QUIET_PLANTING_EXPERIMENT.md) — Quiet Planting 실험 보고서
- [`DESIGN_RATIONALE.md`](DESIGN_RATIONALE.md) — 전체 설계 근거
